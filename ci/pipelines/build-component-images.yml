## ======================================================================
## GENERATED FILE. DO NOT EDIT
## Generated by running ./ci/configure build-component-images from ~/workspace/cf-for-k8s
## ======================================================================

groups:
- name: all
  jobs:
  - build-statsd_exporter-cf-for-k8s-image
- name: statsd-exporter
  jobs:
  - build-statsd_exporter-cf-for-k8s-image
resources:
- name: cf-for-k8s-ci
  type: git
  icon: github
  source:
    branch: develop
    uri: git@github.com:cloudfoundry/cf-for-k8s
    private_key: ((cf_for_k8s_readonly_deploy_key.private_key))
    paths:
    - ci/**
- name: statsd_exporter
  type: git
  source:
    uri: git@github.com:prometheus/statsd_exporter
    private_key: ((cf_for_k8s_readonly_deploy_key.private_key))
- name: cf-k8s-prometheus
  type: git
  source:
    uri: git@github.com:cloudfoundry/cf-k8s-prometheus
    private_key: ((cf_for_k8s_readonly_deploy_key.private_key))
- name: statsd-exporter-release
  type: github-release
  source:
    owner: prometheus
    repository: statsd_exporter
    access_token: ((cf_deployment_release_bot_access_token))
- name: statsd_exporter-cf-for-k8s-registry-image
  type: registry-image
  source:
    repository: cloudfoundry/statsd_exporter-cf-for-k8s
    username: ((dockerhub.username))
    password: ((dockerhub.password))
jobs:
- name: build-statsd_exporter-cf-for-k8s-image
  plan:
  - in_parallel:
    - get: cf-for-k8s-ci
    - get: statsd-exporter-release
      trigger: true
    - get: statsd_exporter
    - get: cf-k8s-prometheus
  - task: build-statsd_exporter-cf-for-k8s-image
    privileged: true
    input_mapping:
      dockerfile: cf-k8s-prometheus
      context: statsd_exporter
    config:
      platform: linux
      image_resource:
        type: registry-image
        source:
          repository: vito/oci-build-task
      inputs:
      - name: dockerfile
      - name: context
      outputs:
      - name: image
      caches:
      - path: cache
      run:
        path: build
      params:
        DOCKERFILE: dockerfile/exporters/statsd_exporter/Dockerfile
        CONTEXT: context/.
  - task: deplab-statsd_exporter-cf-for-k8s-image
    privileged: true
    input_mapping:
      source: statsd_exporter
    config:
      platform: linux
      image_resource:
        type: registry-image
        source:
          repository: cloudfoundry/cf-for-k8s-deplab
      inputs:
      - name: source
      - name: image
      outputs:
      - name: deplab-image
      run:
        path: /bin/sh
        args:
        - -c
        - |
          deplab --image-tar image/image.tar \
            --git source \
            --output-tar deplab-image/image.tar
  - put: statsd_exporter-cf-for-k8s-registry-image
    params:
      image: deplab-image/image.tar
